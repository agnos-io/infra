{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "environment": { "type": "object" },
      "auth0": { "type": "object" },
      "webApps": { "type": "object" },
      "apim": { "type": "object" },
      "shared": { "type": "object" },
      "domainServices": { "type": "object" }
    },
    "variables": {
      "appi-name": "[concat('appi-',  parameters('environment').name)]",
      "appi-ref": "[resourceId('Microsoft.Insights/components', variables('appi-name'))]",
      "afs-stg-ref": "[resourceId(parameters('domainServices').caseManagement.phiStorage.resourceGroup,'Microsoft.Storage/storageAccounts', parameters('domainServices').caseManagement.phiStorage.name)]",
      "afs-ref": "[resourceId(parameters('domainServices').caseManagement.phiStorage.resourceGroup,'Microsoft.StorageSync/storageSyncServices', parameters('domainServices').caseManagement.phiStorage.storageSyncService)]",
      "dashboard-name": "[concat('dashboard-',  parameters('environment').name)]",
      "req-count": "  requests | join kind= leftouter (customEvents) on $left.operation_Id==$right.operation_Id| summarize AllRequests = count(),  FailedRequests = countif(toint(resultCode) >=500), FullMsg = any(pack_all()) by Request = name| order by FailedRequests desc;",
      "ex-with-count": " let dataset=union (traces | where customDimensions.LogLevel == 'Error') ,customEvents, exceptions ,(requests | where success == false); dataset  | project operation_Name= case(isempty(operation_Name), customDimensions.MS_FunctionName, operation_Name), Exception= strcat(message, problemId), cloud_RoleName,  details | where strlen(['details']) >0;",
      "ex-by-opn": " customEvents| where customDimensions['response'] != ''| extend httpResponse = todynamic(tostring(customDimensions.response))| project timestamp,httpResponse,httpStatusCode = httpResponse.status,stats = case(isempty(httpResponse), 'x', httpResponse.statusText),operation_Name= case(isempty(operation_Name), customDimensions.MS_FunctionName, operation_Name),Information= customDimensions,FullMsg = pack_all()| where httpResponse.status >= 500;",
      "ex-by-types": "  let dataset=union (traces | where customDimensions.LogLevel == 'Error'), exceptions,customEvents ,(requests | where success == false)  ;dataset| summarize count_=sum(itemCount)  by Exception=strcat(name,problemId,message)| union(dataset  | summarize count_=sum(itemCount)   | extend Exception='Overall')| where count_ > 0| order by count_ desc; ",
      "ex-count-by-opn-chart": "  union (traces | where customDimensions.LogLevel == 'Error'),customEvents,exceptions,(requests | where success == false )| summarize failedCount=sum(itemCount)by operation_Name| order by failedCount desc;",
      "req-status-code-chart": " requests| where resultCode !=0 | summarize Requests = count() by Result = strcat('Http ', resultCode)| order by Requests desc;",
      "failed-dependencies-status-code-chart": " let dataset=dependencies| where success == false;dataset| summarize _count=sum(itemCount) by type| sort by _count desc;",
      "domain-service-req-count": " requests | join kind= leftouter (customEvents) on $left.operation_Id == $right.operation_Id | summarize AllRequests = count(), FailedCount = countif(success == false or (itemType1 =~ 'customEvent' and isnotempty(name1))) by DomainService = cloud_RoleName | order by FailedCount desc;"
    },
    "resources": [
      {
        "properties": {
          "lenses": {
            "0": {
              "order": 0,
              "parts": {
                "0": {
                  "position": {
                    "x": 0,
                    "y": 0,
                    "colSpan": 2,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "id",
                        "value": "[variables('appi-ref')]"
                      },
                      {
                        "name": "Version",
                        "value": "1.0"
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                    "asset": {
                      "idInputName": "id",
                      "type": "ApplicationInsights"
                    },
                    "defaultMenuItemId": "overview"
                  }
                },
                "1": {
                  "position": {
                    "x": 2,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ComponentId",
                        "value": {
                          "Name": "[variables('appi-name')]",
                          "SubscriptionId": "[subscription().subscriptionId]",
                          "ResourceGroup": "[resourceGroup().name]"
                        }
                      },
                      {
                        "name": "TimeContext",
                        "value": {
                          "durationMs": 86400000,
                          "endTime": null,
                          "createdTime": "2018-05-08T18:47:35.237Z",
                          "isInitialTime": true,
                          "grain": 1,
                          "useDashboardTimeRange": false
                        }
                      },
                      {
                        "name": "ConfigurationId",
                        "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                      },
                      {
                        "name": "MainResourceId",
                        "isOptional": true
                      },
                      {
                        "name": "ResourceIds",
                        "isOptional": true
                      },
                      {
                        "name": "DataModel",
                        "isOptional": true
                      },
                      {
                        "name": "UseCallerTimeContext",
                        "isOptional": true
                      },
                      {
                        "name": "OverrideSettings",
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/ApplicationMapPart",
                    "settings": {},
                    "asset": {
                      "idInputName": "ComponentId",
                      "type": "ApplicationInsights"
                    },
                    "defaultMenuItemId": "applicationMap"
                  }
                },
                "2": {
                  "position": {
                    "x": 3,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ResourceId",
                        "value": "[variables('appi-ref')]"
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                    "isAdapter": true,
                    "asset": {
                      "idInputName": "ResourceId",
                      "type": "ApplicationInsights"
                    },
                    "defaultMenuItemId": "failures"
                  }
                },
                "3": {
                  "position": {
                    "x": 4,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ResourceId",
                        "value": "[variables('appi-ref')]"
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                    "isAdapter": true,
                    "asset": {
                      "idInputName": "ResourceId",
                      "type": "ApplicationInsights"
                    },
                    "defaultMenuItemId": "performance"
                  }
                },
                "4": {
                  "position": {
                    "x": 5,
                    "y": 0,
                    "colSpan": 2,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ResourceId",
                        "value": "[variables('appi-ref')]",
                        "isOptional": true
                      },
                      {
                        "name": "FilterSpec",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/SearchV2PinnedPart",
                    "deepLink": "#@agnos.onmicrosoft.com/resource[variables('appi-ref')]/searchV1"
                  }
                },
                "5": {
                  "position": {
                    "x": 7,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ComponentId",
                        "value": {
                          "Name": "[variables('appi-name')]",
                          "SubscriptionId": "[subscription().subscriptionId]",
                          "ResourceGroup": "[resourceGroup().name]"
                        }
                      },
                      {
                        "name": "MetricsExplorerJsonDefinitionId",
                        "value": "BrowserPerformanceTimelineMetrics"
                      },
                      {
                        "name": "TimeContext",
                        "value": {
                          "durationMs": 86400000,
                          "createdTime": "2018-05-08T12:16:27.534Z",
                          "isInitialTime": false,
                          "grain": 1,
                          "useDashboardTimeRange": false
                        }
                      },
                      {
                        "name": "CurrentFilter",
                        "value": {
                          "eventTypes": [
                            4,
                            1,
                            3,
                            5,
                            2,
                            6,
                            13
                          ],
                          "typeFacets": {},
                          "isPermissive": false
                        }
                      },
                      {
                        "name": "id",
                        "value": {
                          "Name": "[variables('appi-name')]",
                          "SubscriptionId": "[subscription().subscriptionId]",
                          "ResourceGroup": "[resourceGroup().name]"
                        }
                      },
                      {
                        "name": "Version",
                        "value": "1.0"
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                    "asset": {
                      "idInputName": "ComponentId",
                      "type": "ApplicationInsights"
                    },
                    "defaultMenuItemId": "browser"
                  }
                },
                "6": {
                  "position": {
                    "x": 8,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ComponentId",
                        "value": {
                          "Name": "[variables('appi-name')]",
                          "SubscriptionId": "[subscription().subscriptionId]",
                          "ResourceGroup": "[resourceGroup().name]"
                        }
                      },
                      {
                        "name": "TimeContext",
                        "value": {
                          "durationMs": 86400000,
                          "endTime": null,
                          "createdTime": "2018-05-04T01:22:35.782Z",
                          "isInitialTime": true,
                          "grain": 1,
                          "useDashboardTimeRange": false
                        }
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                    "asset": {
                      "idInputName": "ComponentId",
                      "type": "ApplicationInsights"
                    }
                  }
                },
                "7": {
                  "position": {
                    "x": 9,
                    "y": 0,
                    "colSpan": 1,
                    "rowSpan": 1
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "ComponentId",
                        "value": {
                          "Name": "[variables('appi-name')]",
                          "SubscriptionId": "[subscription().subscriptionId]",
                          "ResourceGroup": "[resourceGroup().name]"
                        }
                      },
                      {
                        "name": "ResourceId",
                        "value": "[variables('appi-ref')]"
                      }
                    ],
                    "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                    "asset": {
                      "idInputName": "ComponentId",
                      "type": "ApplicationInsights"
                    }
                  }
                },
                "8": {
                  "position": {
                    "x": 0,
                    "y": 1,
                    "colSpan": 7,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "8c2d8943-07df-42ec-a133-44514e12a629",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P7D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      //{
                      //  "name": "Query",
                      //  "value": "[variables('ex-count-by-opn')]",
                      //  "isOptional": true
                      //},
                      {
                        "name": "ControlType",
                        "value": "AnalyticsGrid",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "GridColumnsWidth": {
                          "AllRequests": "105px",
                          "FailedRequests": "98px",
                          "FullMsg": "210px"
                        },
                        "Query": "[variables('req-count')]",
                        "PartTitle": "Requests",
                        "PartSubTitle": "Count"
                      }
                    }
                  }
                },
                "9": {
                  "position": {
                    "x": 7,
                    "y": 1,
                    "colSpan": 9,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "value": {
                          "xAxis": {
                            "name": "Request",
                            "type": "string"
                          },
                          "yAxis": [
                            {
                              "name": "AllRequests",
                              "type": "long"
                            }
                          ],
                          "splitBy": [],
                          "aggregation": "Sum"
                        },
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "41211e4e-05be-4198-a870-495cf68ebfa2",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('req-count')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "FrameControlChart",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "value": "Pie",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "Query": "[variables('req-count')]",
                        "PartTitle": "Requests(%)",
                        "PartSubTitle": "Count (%)"
                      }
                    }
                  }
                },
                "10": {
                  "position": {
                    "x": 0,
                    "y": 5,
                    "colSpan": 16,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "578ef117-b752-4677-99ac-599253ca7374",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('ex-by-opn')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "AnalyticsGrid",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "GridColumnsWidth": {
                          "Exception": "442px",
                          "FullMsg": "659px",
                          "Information": "417px"
                        },
                        "PartTitle": "Custom Events",
                        "PartSubTitle": "By operations"
                      }
                    }
                  }
                },
                "11": {
                  "position": {
                    "x": 0,
                    "y": 9,
                    "colSpan": 16,
                    "rowSpan": 5
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "138ab330-0ab4-428c-b315-dbdd33a1093a",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('ex-with-count')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "AnalyticsGrid",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "GridColumnsWidth": {
                          "problemId": "348px",
                          "operation_Name": "288px",
                          "cloud_RoleName": "212px",
                          "stacktrace_": "528px",
                          "Exception": "419px",
                          "details": "461px"
                        },
                        "PartTitle": "Exceptions",
                        "PartSubTitle": "with count"
                      }
                    }
                  }
                },
                "12": {
                  "position": {
                    "x": 0,
                    "y": 14,
                    "colSpan": 16,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "value": {
                          "xAxis": {
                            "name": "Exception",
                            "type": "string"
                          },
                          "yAxis": [
                            {
                              "name": "count_",
                              "type": "long"
                            }
                          ],
                          "splitBy": [],
                          "aggregation": "Sum"
                        },
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "7cbc17ab-40d6-47b8-b139-c5abf749619a",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('ex-by-types')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "FrameControlChart",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "value": "StackedBar",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "Query": "[variables('ex-by-types')]",
                        "PartTitle": "Exceptions",
                        "PartSubTitle": "By Types"
                      }
                    }
                  }
                },
                "13": {
                  "position": {
                    "x": 0,
                    "y": 18,
                    "colSpan": 8,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "value": {
                          "xAxis": {
                            "name": "operation_Name",
                            "type": "string"
                          },
                          "yAxis": [
                            {
                              "name": "failedCount",
                              "type": "long"
                            }
                          ],
                          "splitBy": [],
                          "aggregation": "Sum"
                        },
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "91aba562-e799-4875-910c-caf9416b4346",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P2D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "FrameControlChart",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "value": "Pie",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "Query": "[variables('ex-count-by-opn-chart')]",
                        "PartTitle": "Exception Count",
                        "PartSubTitle": "By Operations"
                      }
                    }
                  }
                },
                "14": {
                  "position": {
                    "x": 8,
                    "y": 18,
                    "colSpan": 8,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "value": {
                          "xAxis": {
                            "name": "Result",
                            "type": "string"
                          },
                          "yAxis": [
                            {
                              "name": "Requests",
                              "type": "long"
                            }
                          ],
                          "splitBy": [],
                          "aggregation": "Sum"
                        },
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "1180cb60-4a40-4c08-ab10-bf6c8e27876c",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('req-status-code-chart')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "FrameControlChart",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "value": "Pie",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "Query": "[variables('req-status-code-chart')]",
                        "PartTitle": "Request Status",
                        "PartSubTitle": "Code"
                      }
                    }
                  }
                },
                "15": {
                  "position": {
                    "x": 0,
                    "y": 22,
                    "colSpan": 8,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "value": {
                          "xAxis": {
                            "name": "type",
                            "type": "string"
                          },
                          "yAxis": [
                            {
                              "name": "_count",
                              "type": "long"
                            }
                          ],
                          "splitBy": [],
                          "aggregation": "Sum"
                        },
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "15a6f7ed-85dd-42ef-b211-5fddafc9c039",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('failed-dependencies-status-code-chart')]",
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "FrameControlChart",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "value": "Donut",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "[variables('appi-name')]",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "Query": "[variables('failed-dependencies-status-code-chart')]",
                        "PartTitle": "Failed Dependencies",
                        "PartSubTitle": "status-code"
                      }
                    }
                  }
                },
                "16": {
                  "position": {
                    "x": 8,
                    "y": 22,
                    "colSpan": 8,
                    "rowSpan": 4
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "resourceTypeMode",
                        "isOptional": true
                      },
                      {
                        "name": "ComponentId",
                        "isOptional": true
                      },
                      {
                        "name": "Scope",
                        "value": {
                          "resourceIds": [
                            "[variables('appi-ref')]"
                          ]
                        },
                        "isOptional": true
                      },
                      {
                        "name": "Dimensions",
                        "isOptional": true
                      },
                      {
                        "name": "PartId",
                        "value": "9c438324-59e6-4dbc-9a3c-42d7f89d8484",
                        "isOptional": true
                      },
                      {
                        "name": "Version",
                        "value": "2.0",
                        "isOptional": true
                      },
                      {
                        "name": "TimeRange",
                        "value": "P1D",
                        "isOptional": true
                      },
                      {
                        "name": "DashboardId",
                        "isOptional": true
                      },
                      {
                        "name": "DraftRequestParameters",
                        "isOptional": true
                      },
                      {
                        "name": "Query",
                        "value": "[variables('domain-service-req-count')]",
  
                        "isOptional": true
                      },
                      {
                        "name": "ControlType",
                        "value": "AnalyticsGrid",
                        "isOptional": true
                      },
                      {
                        "name": "SpecificChart",
                        "isOptional": true
                      },
                      {
                        "name": "PartTitle",
                        "value": "Analytics",
                        "isOptional": true
                      },
                      {
                        "name": "PartSubTitle",
                        "value": "appi-eht-dev-02",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/Microsoft_OperationsManagementSuite_Workspace/PartType/LogsDashboardPart",
                    "settings": {
                      "content": {
                        "GridColumnsWidth": {
                          "DomainService": "350px",
                          "AllRequests": "154px"
                        },
                        "PartTitle": "Request Count",
                        "PartSubTitle": "per domain service"
                      }
                    }
                  }
                },
                "17": {
                  "position": {
                    "x": 0,
                    "y": 26,
                    "colSpan": 8,
                    "rowSpan": 3
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "options",
                        "value": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('appi-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 4,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 7,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              }
                            ],
                            "title": "AFS-FileSynced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              }
                            },
                            "timespan": {
                              "relative": {
                                "duration": 86400000
                              },
                              "showUTCTime": false,
                              "grain": 1
                            }
                          }
                        },
                        "isOptional": true
                      },
                      {
                        "name": "sharedTimeRange",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                    "settings": {
                      "content": {
                        "options": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('appi-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 4,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionAppliedFilesCount",
                                "aggregationType": 7,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files Synced"
                                }
                              }
                            ],
                            "title": "AFS-FileSynced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              },
                              "disablePinning": true
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "18": {
                  "position": {
                    "x": 8,
                    "y": 26,
                    "colSpan": 8,
                    "rowSpan": 3
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "options",
                        "value": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionPerItemErrorsCount",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files not syncing"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionPerItemErrorsCount",
                                "aggregationType": 7,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files not syncing"
                                }
                              }
                            ],
                            "title": "AFS-FileNotSynced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              }
                            },
                            "timespan": {
                              "relative": {
                                "duration": 86400000
                              },
                              "showUTCTime": false,
                              "grain": 1
                            }
                          }
                        },
                        "isOptional": true
                      },
                      {
                        "name": "sharedTimeRange",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                    "settings": {
                      "content": {
                        "options": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionPerItemErrorsCount",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files not syncing"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncSyncSessionPerItemErrorsCount",
                                "aggregationType": 7,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Files not syncing"
                                }
                              }
                            ],
                            "title": "AFS-FileNotSynced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              },
                              "disablePinning": true
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "19": {
                  "position": {
                    "x": 0,
                    "y": 29,
                    "colSpan": 8,
                    "rowSpan": 3
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "options",
                        "value": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncBatchTransferredFileBytes",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Bytes synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncBatchTransferredFileBytes",
                                "aggregationType": 4,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Bytes synced"
                                }
                              }
                            ],
                            "title": "AFS- Bytes Synced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              }
                            },
                            "timespan": {
                              "relative": {
                                "duration": 86400000
                              },
                              "showUTCTime": false,
                              "grain": 1
                            }
                          }
                        },
                        "isOptional": true
                      },
                      {
                        "name": "sharedTimeRange",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                    "settings": {
                      "content": {
                        "options": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncBatchTransferredFileBytes",
                                "aggregationType": 1,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Bytes synced"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-ref')]"
                                },
                                "name": "StorageSyncBatchTransferredFileBytes",
                                "aggregationType": 4,
                                "namespace": "microsoft.storagesync/storagesyncservices",
                                "metricVisualization": {
                                  "displayName": "Bytes synced"
                                }
                              }
                            ],
                            "title": "AFS- Bytes Synced",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 1,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              },
                              "disablePinning": true
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "20": {
                  "position": {
                    "x": 8,
                    "y": 29,
                    "colSpan": 8,
                    "rowSpan": 3
                  },
                  "metadata": {
                    "inputs": [
                      {
                        "name": "options",
                        "value": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Egress",
                                "aggregationType": 4,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Egress"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Availability",
                                "aggregationType": 4,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Availability"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Ingress",
                                "aggregationType": 1,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Ingress"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Transactions",
                                "aggregationType": 1,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Transactions"
                                }
                              }
                            ],
                            "title": "AFS-File Storage Monitor",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 2,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              }
                            },
                            "timespan": {
                              "relative": {
                                "duration": 86400000
                              },
                              "showUTCTime": false,
                              "grain": 1
                            }
                          }
                        },
                        "isOptional": true
                      },
                      {
                        "name": "sharedTimeRange",
                        "isOptional": true
                      }
                    ],
                    "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                    "settings": {
                      "content": {
                        "options": {
                          "chart": {
                            "metrics": [
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Egress",
                                "aggregationType": 4,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Egress"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Availability",
                                "aggregationType": 4,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Availability"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Ingress",
                                "aggregationType": 1,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Ingress"
                                }
                              },
                              {
                                "resourceMetadata": {
                                  "id": "[variables('afs-stg-ref')]"
                                },
                                "name": "Transactions",
                                "aggregationType": 1,
                                "namespace": "microsoft.storage/storageaccounts/fileservices",
                                "metricVisualization": {
                                  "displayName": "Transactions"
                                }
                              }
                            ],
                            "title": "AFS-File Storage Monitor",
                            "titleKind": 2,
                            "visualization": {
                              "chartType": 2,
                              "legendVisualization": {
                                "isVisible": true,
                                "position": 2,
                                "hideSubtitle": false
                              },
                              "axisVisualization": {
                                "x": {
                                  "isVisible": true,
                                  "axisType": 2
                                },
                                "y": {
                                  "isVisible": true,
                                  "axisType": 1
                                }
                              },
                              "disablePinning": true
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "metadata": {
            "model": {
              "timeRange": {
                "value": {
                  "relative": {
                    "duration": 24,
                    "timeUnit": 1
                  }
                },
                "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
              },
              "filterLocale": {
                "value": "en-us"
              },
              "filters": {
                "value": {
                  "MsPortalFx_TimeRange": {
                    "model": {
                      "format": "utc",
                      "granularity": "auto",
                      "relative": "24h"
                    },
                    "displayCache": {
                      "name": "UTC Time",
                      "value": "Past 24 hours"
                    }
                  }
                }
              }
            }
          }
        },
        "name": "[variables('dashboard-name')]",
        "type": "Microsoft.Portal/dashboards",
        "location": "[resourceGroup().location]",
        "tags": {
          "hidden-title": "[variables('dashboard-name')]",
          "environment": "[ parameters('environment').name]",
          "dashobard": "[variables('dashboard-name')]"
        },
        "apiVersion": "2015-08-01-preview"
      }
    ]
  }